<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Respawn de MVPs - Ragnarok</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            background: #1b1b1b;
            color: #eee;
            font-family: Arial, sans-serif;
            margin: 0;
        }

        .wrapper {
            width: 90%;
            max-width: 1000px;
            padding: 20px;
        }

        .selector {
            margin-bottom: 20px;
            text-align: center;
        }

        .section {
            margin-bottom: 40px;
        }

            .section h2 {
                margin-bottom: 10px;
            }

        #active, #container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        /* padrão: 1 por linha */
        .mvp-block {
            display: flex;
            align-items: flex-start;
            flex: 0 0 100%;
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
        }

        /* somente “Em Contagem Regressiva”: 2 por linha (leva em conta o gap de 20px) */
        #active .mvp-block {
            flex: 0 0 calc((100% - 20px) / 2);
        }

        .mob-img {
            width: 80px;
            height: 80px;
            margin-right: 10px;
            border-radius: 6px;
            flex-shrink: 0;
        }

        .map-container {
            position: relative;
            margin-right: 20px;
        }

            .map-container img {
                width: 200px;
                border: 2px solid #444;
                border-radius: 6px;
                cursor: pointer;
                display: block;
            }

        .tomb {
            position: absolute;
            width: 24px;
            height: 24px;
            background: url('https://play-lh.googleusercontent.com/tJFGni5yOgBaZ8XKbh2aejYf6IVVfwF4xbuBIBDxbQmIWll6nfT0RgLNb8U2HZwckYw') no-repeat center/contain;
            pointer-events: none;
        }

        .info {
            font-size: 14px;
            flex: 1;
        }

        .timer {
            margin: 5px 0;
            font-weight: bold;
        }

            .timer.green {
                color: #0f0;
            }

            .timer.red {
                color: #f00;
            }

        input[type="time"], button, select {
            margin-right: 5px;
            padding: 4px 8px;
            border-radius: 4px;
            border: none;
        }

        input[type="time"], select {
            background: #333;
            color: #eee;
        }

        button {
            background: #ff9800;
            color: #fff;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <h1 style="text-align:center;">Calculadora de Respawn de MVPs</h1>
        <div class="selector">
            <select id="mvp-select"><option value="">--Selecione um MVP--</option></select>
            <button id="show-all">Mostrar Todos</button>
        </div>
        <audio id="alertSound"><source src="https://notificationsounds.com/storage/sounds/file-sounds-467-arpeggio.mp3" type="audio/mpeg"></audio>
        <div id="active-section" class="section">
            <h2>Em Contagem Regressiva</h2>
            <div id="active"></div>
        </div>
        <div id="upcoming-section" class="section">
            <h2>Próximos MVPs</h2>
            <div id="container"></div>
        </div>
    </div>
    <script>
  const mvpList = [
    { id: 1087, name: 'Orc Herói', respawn: [ { map: 'gef_fild02', cdr: 86400000, max_delay: 600000 }, { map: 'gef_fild14', cdr: 3600000, max_delay: 600000 } ] },
    { id: 1190, name: 'Senhor dos Orcs', respawn: [ { map: 'gef_fild10', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1252, name: 'Hatii', respawn: [ { map: 'xmas_fild01', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1059, name: 'Abelha-Rainha', respawn: [ { map: 'mjolnir_04', cdr: 7200000, max_delay: 600000 }, { map: 'gld_dun02', cdr: 28800000, max_delay: 600000 } ] },
    { id: 1159, name: 'Phreeoni', respawn: [ { map: 'moc_fild17', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1917, name: 'Morroc Ferido', respawn: [ { map: 'moc_fild22', cdr: 43200000, max_delay: 600000 } ] },
    { id: 1096, name: 'Angeling', respawn: [ { map: 'pay_fild04', cdr: 3600000, max_delay: 1800000 }, { map: 'yuno_fild03', cdr: 3600000, max_delay: 1800000 }, { map: 'xmas_dun01', cdr: 3600000, max_delay: 1800000 } ] },
    { id: 1120, name: 'Ghostring', respawn: [ { map: 'pay_fild04', cdr: 3600000, max_delay: 1800000 }, { map: 'gld_dun04', cdr: 14400000, max_delay: 7200000 }, { map: 'prt_maze03', cdr: 6800000, max_delay: 3400000 }, { map: 'treasure02', cdr: 1980000, max_delay: 1200000 } ] },
    { id: 1582, name: 'Deviling', respawn: [ { map: 'pay_fild04', cdr: 7200000, max_delay: 3600000 }, { map: 'yuno_fild03', cdr: 3600000, max_delay: 1800000 } ] },
    { id: 1115, name: 'Eddga', respawn: [ { map: 'pay_fild10', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1785, name: 'Atroce', respawn: [ { map: 'ra_fild03', cdr: 10800000, max_delay: 600000 }, { map: 'ra_fild04', cdr: 18000000, max_delay: 600000 }, { map: 've_fild01', cdr: 10800000, max_delay: 600000 }, { map: 've_fild02', cdr: 21600000, max_delay: 600000 } ] },
    { id: 1388, name: 'Arc Angeling', respawn: [ { map: 'yuno_fild05', cdr: 3600000, max_delay: 180000 } ] },
    { id: 1871, name: 'Bispo Decadente', respawn: [ { map: 'abbey02', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1873, name: 'Belzebu', respawn: [ { map: 'abbey03', cdr: 43200000, max_delay: 600000 } ] },
    { id: 1719, name: 'Detardeurus', respawn: [ { map: 'abyss_03', cdr: 10800000, max_delay: 600000 } ] },
    { id: 1492, name: 'Samurai Encarnado', respawn: [ { map: 'ama_dun03', cdr: 5460000, max_delay: 600000 } ] },
    { id: 1147, name: 'Maya', respawn: [ { map: 'anthell02', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1688, name: 'Lady Tanee', respawn: [ { map: 'ayo_dun02', cdr: 25200000, max_delay: 600000 } ] },
    { id: 1583, name: 'Tao Gunka', respawn: [ { map: 'beach_dun', cdr: 18000000, max_delay: 600000 } ] },
    { id: 2068, name: 'Boitata', respawn: [ { map: 'bra_dun02', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1623, name: 'RSX-0806', respawn: [ { map: 'ein_dun02', cdr: 7500000, max_delay: 600000 } ] },
    { id: 1389, name: 'Drácula', respawn: [ { map: 'gef_dun01', cdr: 3600000, max_delay: 600000 } ] },
    { id: 1046, name: 'Doppelganger', respawn: [ { map: 'gef_dun02', cdr: 7200000, max_delay: 600000 }, { map: 'gld_dun04', cdr: 28800000, max_delay: 600000 } ] },
    { id: 1272, name: 'Senhor das Trevas', respawn: [ { map: 'gl_chyard', cdr: 3600000, max_delay: 600000 } ] },
    { id: 1150, name: 'Flor do Luar', respawn: [ { map: 'gld_dun01', cdr: 28800000, max_delay: 600000 }, { map: 'pay_dun04', cdr: 3600000, max_delay: 600000 } ] },
    { id: 1289, name: 'Maya Macho', respawn: [ { map: 'anthell01', cdr: 7200000, max_delay: 0 } ] },
    { id: 1039, name: 'Bafomé', respawn: [ { map: 'gld_dun03', cdr: 28800000, max_delay: 600000 }, { map: 'prt_maze03', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1418, name: 'Serpente Suprema', respawn: [ { map: 'gon_dun03', cdr: 5650000, max_delay: 600000 } ] },
    { id: 1157, name: 'Faraó', respawn: [ { map: 'in_sphinx5', cdr: 3600000, max_delay: 600000 } ] },
    { id: 2202, name: 'Kraken', respawn: [ { map: 'iz_dun05', cdr: 7200000, max_delay: 1800000 } ] },
    { id: 1685, name: 'Vesper', respawn: [ { map: 'jupe_core', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1734, name: 'Kiel D-01', respawn: [ { map: 'kh_dun02', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1658, name: 'Egnigem Cenia', respawn: [ { map: 'lhz_dun02', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1630, name: 'White Lady', respawn: [ { map: 'lou_dun03', cdr: 7000000, max_delay: 600000 } ] },
    { id: 1038, name: 'Osiris', respawn: [ { map: 'moc_pryd04', cdr: 3600000, max_delay: 600000 } ] },
    { id: 1511, name: 'Amon-Ra', respawn: [ { map: 'moc_pryd06', cdr: 3600000, max_delay: 600000 } ] },
    { id: 1885, name: 'Gorynych', respawn: [ { map: 'mosk_dun03', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1751, name: 'Valquíria Randgris', respawn: [ { map: 'odin_tem03', cdr: 28800000, max_delay: 600000 } ] },
    { id: 1086, name: 'Besouro-Ladrão Dourado', respawn: [ { map: 'prt_sewb4', cdr: 3600000, max_delay: 600000 } ] },
    { id: 1768, name: 'Pesar Noturno', respawn: [ { map: 'ra_san05', cdr: 18000000, max_delay: 600000 } ] },
    { id: 1832, name: 'Ifrit', respawn: [ { map: 'thor_v03', cdr: 39600000, max_delay: 600000 } ] },
    { id: 1112, name: 'Drake', respawn: [ { map: 'treasure02', cdr: 7200000, max_delay: 600000 } ] },
    { id: 1312, name: 'General Tartaruga', respawn: [ { map: 'tur_dun04', cdr: 3600000, max_delay: 600000 } ] },
    { id: 1251, name: 'Cavaleiro da Tempestade', respawn: [ { map: 'xmas_dun02', cdr: 3600000, max_delay: 600000 } ] },
    { id: 9999, name: 'World Boss Mamute Albion', respawn: [ { map: 'shore', cdr: 172800000, max_delay: 172800000 } ] }
];
  const savedTimers = JSON.parse(localStorage.getItem('timers') || '{}');
  const savedTombs = JSON.parse(localStorage.getItem('tombs') || '{}');
  const intervals = {};
  const select = document.getElementById('mvp-select');
  mvpList.forEach(m => select.insertAdjacentHTML('beforeend', `<option value="${m.id}">${m.name}</option>`));
  document.getElementById('show-all').onclick = () => render();
  select.onchange = () => render(select.value);
  function saveTimers() { localStorage.setItem('timers', JSON.stringify(savedTimers)); }
  function saveTombs() { localStorage.setItem('tombs', JSON.stringify(savedTombs)); }
  function clearAllIntervals() { Object.values(intervals).forEach(clearInterval); Object.keys(intervals).forEach(k => delete intervals[k]); }
  function formatTime(ts) { const d = new Date(ts); return d.toTimeString().substr(0,5); }
  function formatRem(rem) { const sign = rem < 0 ? '-' : ''; const abs = Math.abs(rem); const mm = Math.floor(abs/60000); const ss = Math.floor((abs%60000)/1000); return `${sign}${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`; }
  function findMvpName(key) { return mvpList.find(m => m.id === parseInt(key.split('-')[0])).name; }
  function placeTomb(e, key) { const cont = e.currentTarget, rect = cont.getBoundingClientRect(); const x = e.clientX-rect.left-12, y = e.clientY-rect.top-12; savedTombs[key] = { x, y }; saveTombs(); placeTombPos(cont, savedTombs[key]); }
  function placeTombPos(cont, pos) { cont.querySelectorAll('.tomb').forEach(t => t.remove()); const t = document.createElement('div'); t.className = 'tomb'; t.style.left = pos.x+'px'; t.style.top = pos.y+'px'; cont.appendChild(t); }
  function start(key, cdr) {
    const tv = document.getElementById(`time-${key}`).value;
    const now = tv ? (()=>{const [h,m]=tv.split(':');const d=new Date();d.setHours(h,m);return d;})() : new Date();
    const resp = new Date(now.getTime() + cdr);
    savedTimers[key] = { ts: resp.getTime(), spawn: formatTime(resp) };
    saveTimers(); render(select.value);
    document.getElementById('alertSound').play();
    Notification.requestPermission().then(() => new Notification(`${findMvpName(key)} respawn!`));
  }
  function startInterval(key) {
    const elTimer = document.getElementById(`timer-${key}`);
    const elSpawn = document.getElementById(`spawn-${key}`);
    const ts = savedTimers[key].ts;
    intervals[key] = setInterval(() => {
      const rem = ts - Date.now();
      elTimer.textContent = formatRem(rem);
      elTimer.className = 'timer ' + (rem <= 0 ? 'red':'green');
      elSpawn.textContent = savedTimers[key].spawn;
      if (rem <= 0) {
        clearInterval(intervals[key]);
        document.getElementById('alertSound').play();
        Notification.requestPermission().then(()=> new Notification(`${findMvpName(key)} respawn!`));
      }
    }, 1000);
  }
  function render(filterId) {
    const now = Date.now();
    clearAllIntervals();
    const activeEntries = [];
    const upcomingEntries = [];
    mvpList.forEach(mvp => {
      if (filterId && mvp.id != filterId) return;
      mvp.respawn.forEach((r,i) => {
        const key = `${mvp.id}-${i}`;
        const ts = savedTimers[key]?.ts || 0;
        const rem = ts ? ts - now : Infinity;
        const entry = { mvp, r, key, ts, rem };
        if (ts) activeEntries.push(entry);
        else upcomingEntries.push(entry);
      });
    });
    activeEntries.sort((a,b) => a.rem - b.rem);
    upcomingEntries.sort((a,b) => (a.r.cdr - b.r.cdr));
    const activeDiv = document.getElementById('active'); activeDiv.innerHTML = '';
    activeEntries.forEach(e => renderBlock(e, activeDiv));
    const cont = document.getElementById('container'); cont.innerHTML = '';
    upcomingEntries.forEach(e => renderBlock(e, cont));
  }
  function renderBlock({ mvp, r, key, ts, rem }, parent) {
    const minutes = r.cdr/60000;
    const block = document.createElement('div'); block.className = 'mvp-block';
    block.innerHTML = `
      <img class="mob-img" src="https://static.divine-pride.net/images/mobs/png/${mvp.id}.png">
      <div class="map-container" id="map-${key}">
        <img src="https://divine-pride.net/img/map/original/${r.map}" alt="${r.map}">
      </div>
      <div class="info">
        <strong>${mvp.name} @ ${r.map}</strong><br>
        Respawn: ${minutes.toFixed(0)} min<br>
        <div class="timer ${rem<=0?'red':'green'}" id="timer-${key}">${ts? formatRem(rem): '--:--'}</div>
        <div>Nascerá em: <span id="spawn-${key}">${ts? formatTime(ts): '--:--'}</span></div>
        <input type="time" id="time-${key}" value=""><button onclick="start('${key}',${r.cdr})">Iniciar</button>
      </div>
    `;
    parent.appendChild(block);
    const mapC = document.getElementById(`map-${key}`);
    mapC.onclick = e => placeTomb(e, key);
    if (savedTombs[key]) placeTombPos(mapC, savedTombs[key]);
    if (ts) startInterval(key);
  }
  render();
    </script>
</body>
</html>
